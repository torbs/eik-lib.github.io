(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{121:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return h}));var r=n(0),i=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=i.a.createContext({}),u=function(e){var t=i.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},m=i.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,o=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=u(n),m=r,h=p["".concat(o,".").concat(m)]||p[m]||b[m]||a;return n?i.a.createElement(h,s(s({ref:t},l),{},{components:n})):i.a.createElement(h,s({ref:t},l))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,o=new Array(a);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var l=2;l<a;l++)o[l]=n[l];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},171:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/travis-settings-d9c37b8b46cf2efb182632b5e92200e2.png"},172:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/travis-settings-page-a682846298f0ba573b5b83514f828486.png"},85:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return u}));var r=n(3),i=n(7),a=(n(0),n(121)),o={id:"travis",title:"Travis",sidebar_label:"Travis"},s={unversionedId:"travis",id:"travis",isDocsHomePage:!1,title:"Travis",description:"Publishing to an Eik server from a Travis CI build can be achieved with a few commands.",source:"@site/docs/travis.md",slug:"/travis",permalink:"/docs/travis",version:"current",sidebar_label:"Travis",sidebar:"mainSidebar",previous:{title:"CI Overview",permalink:"/docs/ci"}},c=[{value:"Setup secrets in Travis",id:"setup-secrets-in-travis",children:[]},{value:"Set up versioning and publishing in .travis.yml",id:"set-up-versioning-and-publishing-in-travisyml",children:[]},{value:"Create a commit script",id:"create-a-commit-script",children:[]},{value:"Run the commit script from .travis.yml",id:"run-the-commit-script-from-travisyml",children:[]}],l={toc:c};function u(e){var t=e.components,o=Object(i.a)(e,["components"]);return Object(a.b)("wrapper",Object(r.a)({},l,o,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"Publishing to an Eik server from a Travis CI build can be achieved with a few commands."),Object(a.b)("h2",{id:"setup-secrets-in-travis"},"Setup secrets in Travis"),Object(a.b)("p",null,"Two secrets will need to be available in order to publish to your Eik server and commit to your git repository. Travis provides a settings page where you can set secret environment variables and we recommend that you use this to do so."),Object(a.b)("p",null,"The Eik server key will need to be obtained from your Eik server provider, a Github personal access token can be created by visiting ",Object(a.b)("a",{parentName:"p",href:"https://github.com/settings/tokens"},"this page"),"."),Object(a.b)("p",null,Object(a.b)("img",{src:n(171).default}),"\n",Object(a.b)("img",{src:n(172).default})),Object(a.b)("h2",{id:"set-up-versioning-and-publishing-in-travisyml"},"Set up versioning and publishing in .travis.yml"),Object(a.b)("p",null,"The following gives an example of how to run version and publish commands from ",Object(a.b)("inlineCode",{parentName:"p"},".travis.yml"),". The login command uses the ",Object(a.b)("inlineCode",{parentName:"p"},"EIK_SERVER_KEY")," that was setup in the previous step."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yml"},"language: node_js\nnode_js:\n  - 14\nbefore_script:\n  - npm i -g @eik/cli\nscript:\n  - eik login -k $EIK_SERVER_KEY\n  - eik version\n  - eik package\n")),Object(a.b)("p",null,"If you have a build step that you need to run before publish, you could just insert that into the ",Object(a.b)("inlineCode",{parentName:"p"},"script")," section as shown."),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yml"},"script:\n  - <build command here>\n  - eik login -k $EIK_SERVER_KEY\n  - eik version\n  - eik package\n")),Object(a.b)("h2",{id:"create-a-commit-script"},"Create a commit script"),Object(a.b)("p",null,"The most challenging part of publishing from CI is committing back to your git repository. The following is an example of a script that commits changes to ",Object(a.b)("inlineCode",{parentName:"p"},"eik.json")," and pushes that commit back to github. It uses the ",Object(a.b)("inlineCode",{parentName:"p"},"GH_TOKEN")," script defined in the first step."),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"commit.sh")),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-sh"},'#!/usr/bin/env bash\n\n# Set the repo name from the github url\n# For git@github.schibsted.io:finn/min-finn.git, the repo name would be min-finn\nREPO="<repo name>"\n\n# Travis doesn\'t make it easy to get the current branch so... this...\nBRANCH=$(if [ "$TRAVIS_PULL_REQUEST" == "false" ]; then echo $TRAVIS_BRANCH; else echo $TRAVIS_PULL_REQUEST_BRANCH; fi)\n\n# Set the user email and name for the commit, set these to whatever you prefer\ngit config --global user.email "travis@travis-ci.org"\ngit config --global user.name "Travis CI"\n\n# Travis checks out a commit hash rather than a branch so we need to add the branch, fetch it and check it out\ngit remote set-branches --add origin $BRANCH\ngit fetch origin\ngit branch $BRANCH origin/$BRANCH\ngit checkout $BRANCH\n\n# Push the changes to the remote\ngit push origin $BRANCH\n')),Object(a.b)("h2",{id:"run-the-commit-script-from-travisyml"},"Run the commit script from .travis.yml"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-yml"},"script:\n  - eik login -k $EIK_SERVER_KEY\n  - eik version\n  - eik package\n  - ./commit.sh\n")),Object(a.b)("p",null,"Once setup, when you push changes to Github, if any of the files to be published have changed, you should automatically get a new published version of your assets on your Eik server and your ",Object(a.b)("inlineCode",{parentName:"p"},"eik.json")," file will have been updated with the new semver version number."))}u.isMDXComponent=!0}}]);